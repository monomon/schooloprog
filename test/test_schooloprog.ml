open Schooloprog

let program = {_|(:classes ((:name "Български език и литература"
                  :teacher ""
                  :start "2024-02-05T08:00:00+02:00"
                  :end "2024-02-05T08:45:00+02:00")
           (:name "Български език и литература"
                  :teacher ""
                  :start "2024-02-05T08:50:00+02:00"
                  :end "2024-02-05T09:35:00+02:00")
           (:name "Математика"
                  :teacher ""
                  :start "2024-02-05T09:40:00+02:00"
                  :end "2024-02-05T10:15:00+02:00")
           (:name "Технологии и предприемачество"
                  :teacher ""
                  :start "2024-02-05T10:20:00+02:00"
                  :end "2024-02-05T11:05:00+02:00")
           (:name "Физическо възпитание и спорт"
                  :teacher ""
                  :start "2024-02-05T11:10:00+02:00"
                  :end "2024-02-05T11:55:00+02:00")

           (:name "Математика"
                  :teacher ""
                  :start "2024-02-06T08:00:00+02:00"
                  :end "2024-02-06T08:45:00+02:00")
           (:name "Български език и литература"
                  :teacher ""
                  :start "2024-02-06T08:50:00+02:00"
                  :end "2024-02-06T09:35:00+02:00")
           (:name "Английски език"
                  :teacher ""
                  :start "2024-02-06T09:40:00+02:00"
                  :end "2024-02-06T10:15:00+02:00")
           (:name "Изобразително изкуство"
                  :teacher ""
                  :start "2024-02-06T10:20:00+02:00"
                  :end "2024-02-06T11:05:00+02:00")
           (:name "Час на класа"
                  :teacher ""
                  :start "2024-02-06T11:10:00+02:00"
                  :end "2024-02-06T11:55:00+02:00")

           (:name "Български език и литература"
                  :teacher ""
                  :start "2024-02-07T08:00:00+02:00"
                  :end "2024-02-07T08:45:00+02:00")
           (:name "Български език и литература"
                  :teacher ""
                  :start "2024-02-07T08:50:00+02:00"
                  :end "2024-02-07T09:35:00+02:00")
           (:name "Математика"
                  :teacher ""
                  :start "2024-02-07T09:40:00+02:00"
                  :end "2024-02-07T10:15:00+02:00")
           (:name "Родинознание"
                  :teacher ""
                  :start "2024-02-07T10:20:00+02:00"
                  :end "2024-02-07T11:05:00+02:00")
           (:name "Музика"
                  :teacher ""
                  :start "2024-02-07T11:10:00+02:00"
                  :end "2024-02-07T11:55:00+02:00")

           (:name "Български език и литература"
                  :teacher ""
                  :start "2024-02-08T08:00:00+02:00"
                  :end "2024-02-08T08:45:00+02:00")
           (:name "Български език и литература"
                  :teacher ""
                  :start "2024-02-08T08:50:00+02:00"
                  :end "2024-02-08T09:35:00+02:00")
           (:name "Изобразително изкуство"
                  :teacher ""
                  :start "2024-02-08T09:40:00+02:00"
                  :end "2024-02-08T10:15:00+02:00")
           (:name "Английски език"
                  :teacher ""
                  :start "2024-02-08T10:20:00+02:00"
                  :end "2024-02-08T11:05:00+02:00")
           (:name "Физическо възпитание и спорт"
                  :teacher ""
                  :start "2024-02-08T11:10:00+02:00"
                  :end "2024-02-08T11:55:00+02:00")

           (:name "Български език и литература"
                  :teacher ""
                  :start "2024-02-09T08:00:00+02:00"
                  :end "2024-02-09T08:45:00+02:00")
           (:name "Математика"
                  :teacher ""
                  :start "2024-02-09T08:50:00+02:00"
                  :end "2024-02-09T09:35:00+02:00")
           (:name "Музика"
                  :teacher ""
                  :start "2024-02-09T09:40:00+02:00"
                  :end "2024-02-09T10:15:00+02:00")
           (:name "Английски език"
                  :teacher ""
                  :start "2024-02-09T10:20:00+02:00"
                  :end "2024-02-09T11:05:00+02:00")
           (:name "Физическо възпитание и спорт"
                  :teacher ""
                  :start "2024-02-09T11:10:00+02:00"
                  :end "2024-02-09T11:55:00+02:00"))
          :year-start "2024-02-06T00:00:00+02:00"
          :year-end "2024-05-29T00:00:00+02:00"
          :holidays ((:name "Официални празници"
                            :date "2024-03-04T00:00:00+02:00")
                     (:name "Ваканции и неучебни дни"
                            :date "2024-04-01T00:00:00+02:00")
                     (:name "Ваканции и неучебни дни"
                            :date "2024-04-02T00:00:00+02:00")
                     (:name "Ваканции и неучебни дни"
                            :date "2024-04-03T00:00:00+02:00")
                     (:name "Ваканции и неучебни дни"
                            :date "2024-04-04T00:00:00+02:00")
                     (:name "Ваканции и неучебни дни"
                            :date "2024-04-05T00:00:00+02:00")
                     (:name "Официални празници"
                            :date "2024-05-01T00:00:00+02:00")
                     (:name "Официални празници"
                            :date "2024-05-03T00:00:00+02:00")
                     (:name "Официални празници"
                            :date "2024-05-06T00:00:00+02:00")
                     (:name "Ваканции и неучебни дни"
                            :date "2024-05-17T00:00:00+02:00")
                     (:name "Ваканции и неучебни дни"
                            :date "2024-05-20T00:00:00+02:00")
                     (:name "Официални празници"
                            :date "2024-05-24T00:00:00+02:00")))|_}

let expected_result = {_|BEGIN:VCALENDAR
VERSION:2.0
PRODID:.//mois@monomon.me//schooloprog//BG
BEGIN:VTIMEZONE
TZID:Europe/Sofia
BEGIN:DAYLIGHT
TZOFFSETFROM:+0100
RRULE:FREQ=YEARLY;BYMONTH=3;BYDAY=-1SU
DTSTART:19810329T020000
TZNAME:EEST
TZOFFSETTO:+0200
END:DAYLIGHT
BEGIN:STANDARD
TZOFFSETFROM:+0100
RRULE:FREQ=YEARLY;BYMONTH=10;BYDAY=-1SU
DTSTART:19810329T020000
TZNAME:EET
TZOFFSETTO:+0200
END:STANDARD
END:VTIMEZONE
BEGIN:VEVENT
UID:
DTSTAMP:20240304T000000Z
DTSTART;TZID=Europe/Sofia:20240304T000000
DURATION:P1D
SUMMARY:\208\158\209\132\208\184\209\134\208\184\208\176\208\187\208\189\208\184 \208\191\209\128\208\176\208\183\208\189\208\184\209\134\208\184
CATEGORIES:holiday
END:VEVENT
BEGIN:VEVENT
UID:
DTSTAMP:20240401T000000Z
DTSTART;TZID=Europe/Sofia:20240401T000000
DURATION:P1D
SUMMARY:\208\146\208\176\208\186\208\176\208\189\209\134\208\184\208\184 \208\184 \208\189\208\181\209\131\209\135\208\181\208\177\208\189\208\184 \208\180\208\189\208\184
CATEGORIES:holiday
END:VEVENT
BEGIN:VEVENT
UID:
DTSTAMP:20240402T000000Z
DTSTART;TZID=Europe/Sofia:20240402T000000
DURATION:P1D
SUMMARY:\208\146\208\176\208\186\208\176\208\189\209\134\208\184\208\184 \208\184 \208\189\208\181\209\131\209\135\208\181\208\177\208\189\208\184 \208\180\208\189\208\184
CATEGORIES:holiday
END:VEVENT
BEGIN:VEVENT
UID:
DTSTAMP:20240403T000000Z
DTSTART;TZID=Europe/Sofia:20240403T000000
DURATION:P1D
SUMMARY:\208\146\208\176\208\186\208\176\208\189\209\134\208\184\208\184 \208\184 \208\189\208\181\209\131\209\135\208\181\208\177\208\189\208\184 \208\180\208\189\208\184
CATEGORIES:holiday
END:VEVENT
BEGIN:VEVENT
UID:
DTSTAMP:20240404T000000Z
DTSTART;TZID=Europe/Sofia:20240404T000000
DURATION:P1D
SUMMARY:\208\146\208\176\208\186\208\176\208\189\209\134\208\184\208\184 \208\184 \208\189\208\181\209\131\209\135\208\181\208\177\208\189\208\184 \208\180\208\189\208\184
CATEGORIES:holiday
END:VEVENT
BEGIN:VEVENT
UID:
DTSTAMP:20240405T000000Z
DTSTART;TZID=Europe/Sofia:20240405T000000
DURATION:P1D
SUMMARY:\208\146\208\176\208\186\208\176\208\189\209\134\208\184\208\184 \208\184 \208\189\208\181\209\131\209\135\208\181\208\177\208\189\208\184 \208\180\208\189\208\184
CATEGORIES:holiday
END:VEVENT
BEGIN:VEVENT
UID:
DTSTAMP:20240501T000000Z
DTSTART;TZID=Europe/Sofia:20240501T000000
DURATION:P1D
SUMMARY:\208\158\209\132\208\184\209\134\208\184\208\176\208\187\208\189\208\184 \208\191\209\128\208\176\208\183\208\189\208\184\209\134\208\184
CATEGORIES:holiday
END:VEVENT
BEGIN:VEVENT
UID:
DTSTAMP:20240503T000000Z
DTSTART;TZID=Europe/Sofia:20240503T000000
DURATION:P1D
SUMMARY:\208\158\209\132\208\184\209\134\208\184\208\176\208\187\208\189\208\184 \208\191\209\128\208\176\208\183\208\189\208\184\209\134\208\184
CATEGORIES:holiday
END:VEVENT
BEGIN:VEVENT
UID:
DTSTAMP:20240506T000000Z
DTSTART;TZID=Europe/Sofia:20240506T000000
DURATION:P1D
SUMMARY:\208\158\209\132\208\184\209\134\208\184\208\176\208\187\208\189\208\184 \208\191\209\128\208\176\208\183\208\189\208\184\209\134\208\184
CATEGORIES:holiday
END:VEVENT
BEGIN:VEVENT
UID:
DTSTAMP:20240517T000000Z
DTSTART;TZID=Europe/Sofia:20240517T000000
DURATION:P1D
SUMMARY:\208\146\208\176\208\186\208\176\208\189\209\134\208\184\208\184 \208\184 \208\189\208\181\209\131\209\135\208\181\208\177\208\189\208\184 \208\180\208\189\208\184
CATEGORIES:holiday
END:VEVENT
BEGIN:VEVENT
UID:
DTSTAMP:20240520T000000Z
DTSTART;TZID=Europe/Sofia:20240520T000000
DURATION:P1D
SUMMARY:\208\146\208\176\208\186\208\176\208\189\209\134\208\184\208\184 \208\184 \208\189\208\181\209\131\209\135\208\181\208\177\208\189\208\184 \208\180\208\189\208\184
CATEGORIES:holiday
END:VEVENT
BEGIN:VEVENT
UID:
DTSTAMP:20240524T000000Z
DTSTART;TZID=Europe/Sofia:20240524T000000
DURATION:P1D
SUMMARY:\208\158\209\132\208\184\209\134\208\184\208\176\208\187\208\189\208\184 \208\191\209\128\208\176\208\183\208\189\208\184\209\134\208\184
CATEGORIES:holiday
END:VEVENT
BEGIN:VEVENT
UID:
DTSTAMP:20240205T080000Z
DTSTART;TZID=Europe/Sofia:20240205T080000
DTEND;TZID=Europe/Sofia:20240205T084500
RRULE:FREQ=WEEKLY;UNTIL=20240529T000000Z
SUMMARY:\208\145\209\138\208\187\208\179\208\176\209\128\209\129\208\186\208\184 \208\181\208\183\208\184\208\186 \208\184 \208\187\208\184\209\130\208\181\209\128\208\176\209\130\209\131\209\128\208\176
CATEGORIES:school,class
EXDATE;TZID=Europe/Sofia:20240304T080000,20240401T080000,20240402T080000,20240403T080000,20240404T080000,20240405T080000,20240501T080000,20240503T080000,20240506T080000,20240517T080000,20240520T080000,20240524T080000
END:VEVENT
BEGIN:VEVENT
UID:
DTSTAMP:20240205T085000Z
DTSTART;TZID=Europe/Sofia:20240205T085000
DTEND;TZID=Europe/Sofia:20240205T093500
RRULE:FREQ=WEEKLY;UNTIL=20240529T000000Z
SUMMARY:\208\145\209\138\208\187\208\179\208\176\209\128\209\129\208\186\208\184 \208\181\208\183\208\184\208\186 \208\184 \208\187\208\184\209\130\208\181\209\128\208\176\209\130\209\131\209\128\208\176
CATEGORIES:school,class
EXDATE;TZID=Europe/Sofia:20240304T085000,20240401T085000,20240402T085000,20240403T085000,20240404T085000,20240405T085000,20240501T085000,20240503T085000,20240506T085000,20240517T085000,20240520T085000,20240524T085000
END:VEVENT
BEGIN:VEVENT
UID:
DTSTAMP:20240205T094000Z
DTSTART;TZID=Europe/Sofia:20240205T094000
DTEND;TZID=Europe/Sofia:20240205T101500
RRULE:FREQ=WEEKLY;UNTIL=20240529T000000Z
SUMMARY:\208\156\208\176\209\130\208\181\208\188\208\176\209\130\208\184\208\186\208\176
CATEGORIES:school,class
EXDATE;TZID=Europe/Sofia:20240304T094000,20240401T094000,20240402T094000,20240403T094000,20240404T094000,20240405T094000,20240501T094000,20240503T094000,20240506T094000,20240517T094000,20240520T094000,20240524T094000
END:VEVENT
BEGIN:VEVENT
UID:
DTSTAMP:20240205T102000Z
DTSTART;TZID=Europe/Sofia:20240205T102000
DTEND;TZID=Europe/Sofia:20240205T110500
RRULE:FREQ=WEEKLY;UNTIL=20240529T000000Z
SUMMARY:\208\162\208\181\209\133\208\189\208\190\208\187\208\190\208\179\208\184\208\184 \208\184 \208\191\209\128\208\181\208\180\208\191\209\128\208\184\208\181\208\188\208\176\209\135\208\181\209\129\209\130\208\178\208\190
CATEGORIES:school,class
EXDATE;TZID=Europe/Sofia:20240304T102000,20240401T102000,20240402T102000,20240403T102000,20240404T102000,20240405T102000,20240501T102000,20240503T102000,20240506T102000,20240517T102000,20240520T102000,20240524T102000
END:VEVENT
BEGIN:VEVENT
UID:
DTSTAMP:20240205T111000Z
DTSTART;TZID=Europe/Sofia:20240205T111000
DTEND;TZID=Europe/Sofia:20240205T115500
RRULE:FREQ=WEEKLY;UNTIL=20240529T000000Z
SUMMARY:\208\164\208\184\208\183\208\184\209\135\208\181\209\129\208\186\208\190 \208\178\209\138\208\183\208\191\208\184\209\130\208\176\208\189\208\184\208\181 \208\184 \209\129\208\191\208\190\209\128\209\130
CATEGORIES:school,class
EXDATE;TZID=Europe/Sofia:20240304T111000,20240401T111000,20240402T111000,20240403T111000,20240404T111000,20240405T111000,20240501T111000,20240503T111000,20240506T111000,20240517T111000,20240520T111000,20240524T111000
END:VEVENT
BEGIN:VEVENT
UID:
DTSTAMP:20240206T080000Z
DTSTART;TZID=Europe/Sofia:20240206T080000
DTEND;TZID=Europe/Sofia:20240206T084500
RRULE:FREQ=WEEKLY;UNTIL=20240529T000000Z
SUMMARY:\208\156\208\176\209\130\208\181\208\188\208\176\209\130\208\184\208\186\208\176
CATEGORIES:school,class
EXDATE;TZID=Europe/Sofia:20240304T080000,20240401T080000,20240402T080000,20240403T080000,20240404T080000,20240405T080000,20240501T080000,20240503T080000,20240506T080000,20240517T080000,20240520T080000,20240524T080000
END:VEVENT
BEGIN:VEVENT
UID:
DTSTAMP:20240206T085000Z
DTSTART;TZID=Europe/Sofia:20240206T085000
DTEND;TZID=Europe/Sofia:20240206T093500
RRULE:FREQ=WEEKLY;UNTIL=20240529T000000Z
SUMMARY:\208\145\209\138\208\187\208\179\208\176\209\128\209\129\208\186\208\184 \208\181\208\183\208\184\208\186 \208\184 \208\187\208\184\209\130\208\181\209\128\208\176\209\130\209\131\209\128\208\176
CATEGORIES:school,class
EXDATE;TZID=Europe/Sofia:20240304T085000,20240401T085000,20240402T085000,20240403T085000,20240404T085000,20240405T085000,20240501T085000,20240503T085000,20240506T085000,20240517T085000,20240520T085000,20240524T085000
END:VEVENT
BEGIN:VEVENT
UID:
DTSTAMP:20240206T094000Z
DTSTART;TZID=Europe/Sofia:20240206T094000
DTEND;TZID=Europe/Sofia:20240206T101500
RRULE:FREQ=WEEKLY;UNTIL=20240529T000000Z
SUMMARY:\208\144\208\189\208\179\208\187\208\184\208\185\209\129\208\186\208\184 \208\181\208\183\208\184\208\186
CATEGORIES:school,class
EXDATE;TZID=Europe/Sofia:20240304T094000,20240401T094000,20240402T094000,20240403T094000,20240404T094000,20240405T094000,20240501T094000,20240503T094000,20240506T094000,20240517T094000,20240520T094000,20240524T094000
END:VEVENT
BEGIN:VEVENT
UID:
DTSTAMP:20240206T102000Z
DTSTART;TZID=Europe/Sofia:20240206T102000
DTEND;TZID=Europe/Sofia:20240206T110500
RRULE:FREQ=WEEKLY;UNTIL=20240529T000000Z
SUMMARY:\208\152\208\183\208\190\208\177\209\128\208\176\208\183\208\184\209\130\208\181\208\187\208\189\208\190 \208\184\208\183\208\186\209\131\209\129\209\130\208\178\208\190
CATEGORIES:school,class
EXDATE;TZID=Europe/Sofia:20240304T102000,20240401T102000,20240402T102000,20240403T102000,20240404T102000,20240405T102000,20240501T102000,20240503T102000,20240506T102000,20240517T102000,20240520T102000,20240524T102000
END:VEVENT
BEGIN:VEVENT
UID:
DTSTAMP:20240206T111000Z
DTSTART;TZID=Europe/Sofia:20240206T111000
DTEND;TZID=Europe/Sofia:20240206T115500
RRULE:FREQ=WEEKLY;UNTIL=20240529T000000Z
SUMMARY:\208\167\208\176\209\129 \208\189\208\176 \208\186\208\187\208\176\209\129\208\176
CATEGORIES:school,class
EXDATE;TZID=Europe/Sofia:20240304T111000,20240401T111000,20240402T111000,20240403T111000,20240404T111000,20240405T111000,20240501T111000,20240503T111000,20240506T111000,20240517T111000,20240520T111000,20240524T111000
END:VEVENT
BEGIN:VEVENT
UID:
DTSTAMP:20240207T080000Z
DTSTART;TZID=Europe/Sofia:20240207T080000
DTEND;TZID=Europe/Sofia:20240207T084500
RRULE:FREQ=WEEKLY;UNTIL=20240529T000000Z
SUMMARY:\208\145\209\138\208\187\208\179\208\176\209\128\209\129\208\186\208\184 \208\181\208\183\208\184\208\186 \208\184 \208\187\208\184\209\130\208\181\209\128\208\176\209\130\209\131\209\128\208\176
CATEGORIES:school,class
EXDATE;TZID=Europe/Sofia:20240304T080000,20240401T080000,20240402T080000,20240403T080000,20240404T080000,20240405T080000,20240501T080000,20240503T080000,20240506T080000,20240517T080000,20240520T080000,20240524T080000
END:VEVENT
BEGIN:VEVENT
UID:
DTSTAMP:20240207T085000Z
DTSTART;TZID=Europe/Sofia:20240207T085000
DTEND;TZID=Europe/Sofia:20240207T093500
RRULE:FREQ=WEEKLY;UNTIL=20240529T000000Z
SUMMARY:\208\145\209\138\208\187\208\179\208\176\209\128\209\129\208\186\208\184 \208\181\208\183\208\184\208\186 \208\184 \208\187\208\184\209\130\208\181\209\128\208\176\209\130\209\131\209\128\208\176
CATEGORIES:school,class
EXDATE;TZID=Europe/Sofia:20240304T085000,20240401T085000,20240402T085000,20240403T085000,20240404T085000,20240405T085000,20240501T085000,20240503T085000,20240506T085000,20240517T085000,20240520T085000,20240524T085000
END:VEVENT
BEGIN:VEVENT
UID:
DTSTAMP:20240207T094000Z
DTSTART;TZID=Europe/Sofia:20240207T094000
DTEND;TZID=Europe/Sofia:20240207T101500
RRULE:FREQ=WEEKLY;UNTIL=20240529T000000Z
SUMMARY:\208\156\208\176\209\130\208\181\208\188\208\176\209\130\208\184\208\186\208\176
CATEGORIES:school,class
EXDATE;TZID=Europe/Sofia:20240304T094000,20240401T094000,20240402T094000,20240403T094000,20240404T094000,20240405T094000,20240501T094000,20240503T094000,20240506T094000,20240517T094000,20240520T094000,20240524T094000
END:VEVENT
BEGIN:VEVENT
UID:
DTSTAMP:20240207T102000Z
DTSTART;TZID=Europe/Sofia:20240207T102000
DTEND;TZID=Europe/Sofia:20240207T110500
RRULE:FREQ=WEEKLY;UNTIL=20240529T000000Z
SUMMARY:\208\160\208\190\208\180\208\184\208\189\208\190\208\183\208\189\208\176\208\189\208\184\208\181
CATEGORIES:school,class
EXDATE;TZID=Europe/Sofia:20240304T102000,20240401T102000,20240402T102000,20240403T102000,20240404T102000,20240405T102000,20240501T102000,20240503T102000,20240506T102000,20240517T102000,20240520T102000,20240524T102000
END:VEVENT
BEGIN:VEVENT
UID:
DTSTAMP:20240207T111000Z
DTSTART;TZID=Europe/Sofia:20240207T111000
DTEND;TZID=Europe/Sofia:20240207T115500
RRULE:FREQ=WEEKLY;UNTIL=20240529T000000Z
SUMMARY:\208\156\209\131\208\183\208\184\208\186\208\176
CATEGORIES:school,class
EXDATE;TZID=Europe/Sofia:20240304T111000,20240401T111000,20240402T111000,20240403T111000,20240404T111000,20240405T111000,20240501T111000,20240503T111000,20240506T111000,20240517T111000,20240520T111000,20240524T111000
END:VEVENT
BEGIN:VEVENT
UID:
DTSTAMP:20240208T080000Z
DTSTART;TZID=Europe/Sofia:20240208T080000
DTEND;TZID=Europe/Sofia:20240208T084500
RRULE:FREQ=WEEKLY;UNTIL=20240529T000000Z
SUMMARY:\208\145\209\138\208\187\208\179\208\176\209\128\209\129\208\186\208\184 \208\181\208\183\208\184\208\186 \208\184 \208\187\208\184\209\130\208\181\209\128\208\176\209\130\209\131\209\128\208\176
CATEGORIES:school,class
EXDATE;TZID=Europe/Sofia:20240304T080000,20240401T080000,20240402T080000,20240403T080000,20240404T080000,20240405T080000,20240501T080000,20240503T080000,20240506T080000,20240517T080000,20240520T080000,20240524T080000
END:VEVENT
BEGIN:VEVENT
UID:
DTSTAMP:20240208T085000Z
DTSTART;TZID=Europe/Sofia:20240208T085000
DTEND;TZID=Europe/Sofia:20240208T093500
RRULE:FREQ=WEEKLY;UNTIL=20240529T000000Z
SUMMARY:\208\145\209\138\208\187\208\179\208\176\209\128\209\129\208\186\208\184 \208\181\208\183\208\184\208\186 \208\184 \208\187\208\184\209\130\208\181\209\128\208\176\209\130\209\131\209\128\208\176
CATEGORIES:school,class
EXDATE;TZID=Europe/Sofia:20240304T085000,20240401T085000,20240402T085000,20240403T085000,20240404T085000,20240405T085000,20240501T085000,20240503T085000,20240506T085000,20240517T085000,20240520T085000,20240524T085000
END:VEVENT
BEGIN:VEVENT
UID:
DTSTAMP:20240208T094000Z
DTSTART;TZID=Europe/Sofia:20240208T094000
DTEND;TZID=Europe/Sofia:20240208T101500
RRULE:FREQ=WEEKLY;UNTIL=20240529T000000Z
SUMMARY:\208\152\208\183\208\190\208\177\209\128\208\176\208\183\208\184\209\130\208\181\208\187\208\189\208\190 \208\184\208\183\208\186\209\131\209\129\209\130\208\178\208\190
CATEGORIES:school,class
EXDATE;TZID=Europe/Sofia:20240304T094000,20240401T094000,20240402T094000,20240403T094000,20240404T094000,20240405T094000,20240501T094000,20240503T094000,20240506T094000,20240517T094000,20240520T094000,20240524T094000
END:VEVENT
BEGIN:VEVENT
UID:
DTSTAMP:20240208T102000Z
DTSTART;TZID=Europe/Sofia:20240208T102000
DTEND;TZID=Europe/Sofia:20240208T110500
RRULE:FREQ=WEEKLY;UNTIL=20240529T000000Z
SUMMARY:\208\144\208\189\208\179\208\187\208\184\208\185\209\129\208\186\208\184 \208\181\208\183\208\184\208\186
CATEGORIES:school,class
EXDATE;TZID=Europe/Sofia:20240304T102000,20240401T102000,20240402T102000,20240403T102000,20240404T102000,20240405T102000,20240501T102000,20240503T102000,20240506T102000,20240517T102000,20240520T102000,20240524T102000
END:VEVENT
BEGIN:VEVENT
UID:
DTSTAMP:20240208T111000Z
DTSTART;TZID=Europe/Sofia:20240208T111000
DTEND;TZID=Europe/Sofia:20240208T115500
RRULE:FREQ=WEEKLY;UNTIL=20240529T000000Z
SUMMARY:\208\164\208\184\208\183\208\184\209\135\208\181\209\129\208\186\208\190 \208\178\209\138\208\183\208\191\208\184\209\130\208\176\208\189\208\184\208\181 \208\184 \209\129\208\191\208\190\209\128\209\130
CATEGORIES:school,class
EXDATE;TZID=Europe/Sofia:20240304T111000,20240401T111000,20240402T111000,20240403T111000,20240404T111000,20240405T111000,20240501T111000,20240503T111000,20240506T111000,20240517T111000,20240520T111000,20240524T111000
END:VEVENT
BEGIN:VEVENT
UID:
DTSTAMP:20240209T080000Z
DTSTART;TZID=Europe/Sofia:20240209T080000
DTEND;TZID=Europe/Sofia:20240209T084500
RRULE:FREQ=WEEKLY;UNTIL=20240529T000000Z
SUMMARY:\208\145\209\138\208\187\208\179\208\176\209\128\209\129\208\186\208\184 \208\181\208\183\208\184\208\186 \208\184 \208\187\208\184\209\130\208\181\209\128\208\176\209\130\209\131\209\128\208\176
CATEGORIES:school,class
EXDATE;TZID=Europe/Sofia:20240304T080000,20240401T080000,20240402T080000,20240403T080000,20240404T080000,20240405T080000,20240501T080000,20240503T080000,20240506T080000,20240517T080000,20240520T080000,20240524T080000
END:VEVENT
BEGIN:VEVENT
UID:
DTSTAMP:20240209T085000Z
DTSTART;TZID=Europe/Sofia:20240209T085000
DTEND;TZID=Europe/Sofia:20240209T093500
RRULE:FREQ=WEEKLY;UNTIL=20240529T000000Z
SUMMARY:\208\156\208\176\209\130\208\181\208\188\208\176\209\130\208\184\208\186\208\176
CATEGORIES:school,class
EXDATE;TZID=Europe/Sofia:20240304T085000,20240401T085000,20240402T085000,20240403T085000,20240404T085000,20240405T085000,20240501T085000,20240503T085000,20240506T085000,20240517T085000,20240520T085000,20240524T085000
END:VEVENT
BEGIN:VEVENT
UID:
DTSTAMP:20240209T094000Z
DTSTART;TZID=Europe/Sofia:20240209T094000
DTEND;TZID=Europe/Sofia:20240209T101500
RRULE:FREQ=WEEKLY;UNTIL=20240529T000000Z
SUMMARY:\208\156\209\131\208\183\208\184\208\186\208\176
CATEGORIES:school,class
EXDATE;TZID=Europe/Sofia:20240304T094000,20240401T094000,20240402T094000,20240403T094000,20240404T094000,20240405T094000,20240501T094000,20240503T094000,20240506T094000,20240517T094000,20240520T094000,20240524T094000
END:VEVENT
BEGIN:VEVENT
UID:
DTSTAMP:20240209T102000Z
DTSTART;TZID=Europe/Sofia:20240209T102000
DTEND;TZID=Europe/Sofia:20240209T110500
RRULE:FREQ=WEEKLY;UNTIL=20240529T000000Z
SUMMARY:\208\144\208\189\208\179\208\187\208\184\208\185\209\129\208\186\208\184 \208\181\208\183\208\184\208\186
CATEGORIES:school,class
EXDATE;TZID=Europe/Sofia:20240304T102000,20240401T102000,20240402T102000,20240403T102000,20240404T102000,20240405T102000,20240501T102000,20240503T102000,20240506T102000,20240517T102000,20240520T102000,20240524T102000
END:VEVENT
BEGIN:VEVENT
UID:
DTSTAMP:20240209T111000Z
DTSTART;TZID=Europe/Sofia:20240209T111000
DTEND;TZID=Europe/Sofia:20240209T115500
RRULE:FREQ=WEEKLY;UNTIL=20240529T000000Z
SUMMARY:\208\164\208\184\208\183\208\184\209\135\208\181\209\129\208\186\208\190 \208\178\209\138\208\183\208\191\208\184\209\130\208\176\208\189\208\184\208\181 \208\184 \209\129\208\191\208\190\209\128\209\130
CATEGORIES:school,class
EXDATE;TZID=Europe/Sofia:20240304T111000,20240401T111000,20240402T111000,20240403T111000,20240404T111000,20240405T111000,20240501T111000,20240503T111000,20240506T111000,20240517T111000,20240520T111000,20240524T111000
END:VEVENT
END:VCALENDAR|_}

let test_cal () =
  let cal = (program |> Sexplib.Sexp.of_string |> to_calendar |> Icalendar.to_ics ~cr:false)
  and expected = (List.sort compare (List.filter
                                       (fun x -> x <> "")
                                       (List.map
                                          (fun x -> x |> String.trim |> Scanf.unescaped)
                                          (String.split_on_char '\n' expected_result))))
  in
  let test_value = (List.sort compare (List.filter
                                         (fun x -> x <> "")
                                         (String.split_on_char '\n' cal)))
  in
  Alcotest.(check (list string) "test basic cal import and export flow"
              expected
              test_value)

let test_exceptions () =
  let cal = (program |> Sexplib.Sexp.of_string |> to_calendar |> Icalendar.to_ics ~cr:false)

  in
  let test_val = (List.find (fun x -> x = "EXDATE;TZID=Europe/Sofia:20240304T111000,20240401T111000,20240402T111000,20240403T111000,20240404T111000,20240405T111000,20240501T111000,20240503T111000,20240506T111000,20240517T111000,20240520T111000,20240524T111000")
                        (String.split_on_char '\n' cal))
  in
  Alcotest.(check string "test cal recurrence exceptions"
              "EXDATE;TZID=Europe/Sofia:20240304T111000,20240401T111000,20240402T111000,20240403T111000,20240404T111000,20240405T111000,20240501T111000,20240503T111000,20240506T111000,20240517T111000,20240520T111000,20240524T111000"
              test_val)

let tests = [
  "basic calendar test", [
    "Test cal", `Quick, test_cal ;
    "Test recurrence exceptions", `Quick, test_exceptions ;
  ];
]

let () =
  Printexc.record_backtrace true;
  Alcotest.run "sexp to ical suite" tests
